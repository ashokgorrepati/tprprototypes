<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CJA Shared Lookups Prototype (v5 - Final Flow)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }
        .nav-tab.active {
            border-bottom-color: #0d86fe;
            color: #0d86fe;
        }
        .btn-primary { background-color: #0d86fe; }
        .btn-primary:hover { background-color: #006edc; }
        .btn-secondary { background-color: #f0f0f0; border: 1px solid #c7c7c7; color: #4b4b4b; }
        .btn-secondary:hover { background-color: #e0e0e0; }
        .spectrum-Tabs-item { display: inline-block; padding: 0 4px 12px 4px; margin: 0 24px -1px 0; font-size: 15px; font-weight: 500; color: #4b4b4b; border-bottom: 2px solid transparent; cursor: pointer; }
        .spectrum-Tabs-item.is-selected { color: #2c2c2c; font-weight: 600; border-bottom-color: #0d86fe; }
        .spectrum-Label { font-size: 12px; font-weight: 600; color: #4b4b4b; margin-bottom: 8px; display: block; }
        .spectrum-Textfield, .spectrum-Picker { display: block; width: 100%; height: 34px; padding: 0 12px; font-size: 14px; border: 1px solid #c7c7c7; border-radius: 5px; background-color: #fff; -webkit-appearance: none; }
        .spectrum-Picker { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2210%22%20height%3D%225%22%20viewBox%3D%220%200%2010%205%22%3E%3Cpath%20d%3D%22M0%200l5%205%205-5z%22%20fill%3D%22%234b4b4b%22%2F%3E'); background-repeat: no-repeat; background-position: right 12px center; background-size: 10px 5px; }
        .badge-new { background-color: #d94434; color: #fff; font-size: 10px; font-weight: 700; padding: 2px 5px; border-radius: 3px; vertical-align: middle; margin-left: 6px; }
        .tooltip-container { position: relative; display: inline-block; }
        .tooltip-icon { width: 14px; height: 14px; border-radius: 50%; background-color: #a0a0a0; color: white; font-size: 10px; font-weight: bold; display: flex; align-items: center; justify-content: center; cursor: help; }
        .tooltip-text { visibility: hidden; width: 220px; background-color: #333; color: #fff; text-align: left; border-radius: 4px; padding: 8px; font-size: 12px; font-weight: normal; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
        .dv-left-rail { background-color: #f8f8f8; border-right: 1px solid #e0e0e0; }
        .dv-component-group { font-size: 11px; font-weight: 600; color: #4b4b4b; padding: 8px 16px; border-top: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; background-color: #f1f1f1; display: flex; align-items: center; gap: 8px; }
        .dv-component-group::before { content: 'â–º'; font-size: 8px; transform: translateY(1px); }
        .dv-component-item { font-size: 14px; padding: 6px 16px 6px 24px; display: flex; align-items: center; gap: 6px; cursor: pointer; }
        .dv-component-item:hover { background-color: #e0e0e0; }
        .dv-component-item::before { content: 'D'; font-size: 10px; font-weight: 600; color: #fff; background-color: #ea4e9d; padding: 2px 4px; border-radius: 3px; }
        .dv-component-item.metric::before { content: 'M'; background-color: #f7a200; }
        .dv-main-table th { font-size: 12px; font-weight: 600; color: #4b4b4b; text-align: left; padding: 8px 12px; border-bottom: 2px solid #e0e0e0; }
        .dv-main-table td { font-size: 14px; color: #2c2c2c; padding: 8px 12px; border-bottom: 1px solid #f1f1f1; }
        .dv-main-table tr.selected-row { background-color: #e6f0ff; }
        .dv-main-table .delete-btn { visibility: hidden; opacity: 0; transition: opacity 0.2s; }
        .dv-main-table tr:hover .delete-btn, .dv-main-table tr.selected-row .delete-btn { visibility: visible; opacity: 1; }

        .ws-table th { background-color: #f9f9f9; font-weight: 600; color: #4b4b4b; }
        .dv-dataset-item { font-size: 14px; padding: 8px 16px; display: flex; align-items: center; gap: 6px; font-weight: 600; cursor: pointer; }
        .dv-dataset-item.active, .dv-dataset-item:hover { background-color: #e0e0e0; }
        .lookup-flyout { background-color: #f0f0f0; padding: 12px 16px; border-bottom: 1px solid #d0d0d0; }
        .lookup-flyout h4 { font-size: 13px; font-weight: 600; margin: 0 0 10px 0; color: #333; }
        .lookup-flyout label { display: block; font-size: 14px; margin-bottom: 8px; padding: 6px 8px; border-radius: 4px; }
        .lookup-flyout label:hover { background-color: #dcdcdc; }
        .lookup-flyout input { margin-right: 6px; accent-color: #0d86fe; }
        
        /* Workspace component pills */
        .dim-pill { font-size: 13px; font-weight: 500; padding: 4px 10px; rounded-full; border: 1px solid #b3d1ff; background-color: #e6f0ff; color: #004a9e; cursor: grab; }
        .metric-pill { font-size: 13px; font-weight: 500; padding: 4px 10px; rounded-full; border: 1px solid #ffecb3; background-color: #fff8e1; color: #614a00; cursor: grab; }

    </style>

    <script>
        // --- Data State ---
        let includedComponents = [
            { id: 'bookings_123', name: 'Bookings', dataset: 'Flight Bookings', schemaPath: '_tenant.bookings', type: 'metric' }
        ];
        let selectedComponentId = null;

        // Define functions in the global scope so inline onclick() can find them
        window.showPage = function(pageId) {
            document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
            const targetPage = document.getElementById(pageId);
            
            if (pageId === 'page-connections') {
                targetPage.style.display = 'flex';
            } else {
                targetPage.style.display = 'block';
            }
            
            // NEW: Render workspace components when switching to that page
            if (pageId === 'page-workspace') {
                renderWorkspaceComponents();
            }

            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.nav-tab[onclick="showPage('${pageId}')"]`).classList.add('active');
        }

        window.addNewPair = function() {
            document.getElementById('key-pair-2').style.display = 'block';
            document.getElementById('add-pair-button-container').style.display = 'none';
        }

        window.toggleAirportDetails = function() {
            const flyout = document.getElementById('airport-details-flyout');
            const toggle = document.getElementById('airport-details-toggle');
            
            if (flyout.style.display === 'none') {
                flyout.style.display = 'block';
                toggle.classList.add('active');
            } else {
                flyout.style.display = 'none';
                toggle.classList.remove('active');
            }
        }

        // --- Data View Functions ---

        // Add a component from the left rail
        window.addComponent = function(fieldKey) {
            let newComponent = {
                id: `comp_${Date.now()}` // Unique ID
            };

            if (fieldKey === 'bookings') {
                // Check if bookings already exists
                if (includedComponents.find(c => c.name === 'Bookings')) return;
                newComponent.name = 'Bookings';
                newComponent.dataset = 'Flight Bookings';
                newComponent.schemaPath = '_tenant.bookings';
                newComponent.type = 'metric';
            } else {
                // Handle shared lookup fields
                const selectedPathRadio = document.querySelector('input[name="join-path"]:checked');
                const pathName = selectedPathRadio ? selectedPathRadio.value : 'Origin Airport'; // Default
                
                if (fieldKey === 'airport_name') {
                    newComponent.name = 'airport_name';
                    newComponent.dataset = `Airport Details (${pathName})`;
                    newComponent.schemaPath = '_tenant.airport_name';
                    newComponent.type = 'dimension';
                } else if (fieldKey === 'city') {
                    newComponent.name = 'city';
                    newComponent.dataset = `Airport Details (${pathName})`;
                    newComponent.schemaPath = '_tenant.city';
                    newComponent.type = 'dimension';
                } else if (fieldKey === 'monthly_campaign_spend') {
                    newComponent.name = 'monthly_campaign_spend';
                    newComponent.dataset = `Airport Details (${pathName})`;
                    newComponent.schemaPath = '_tenant.monthly_campaign_spend';
                    newComponent.type = 'metric';
                }
            }
            
            includedComponents.push(newComponent);
            renderIncludedComponents();
            selectComponent(newComponent.id); // Auto-select the new component
        }

        // Re-draw the center panel list
        window.renderIncludedComponents = function() {
            const metricsBody = document.getElementById('metrics-tbody');
            const dimensionsBody = document.getElementById('dimensions-tbody');
            const componentCount = document.getElementById('component-count');

            if (!metricsBody || !dimensionsBody) return;

            metricsBody.innerHTML = '';
            dimensionsBody.innerHTML = '';
            componentCount.textContent = includedComponents.length;

            let metricCount = 0;
            let dimensionCount = 0;

            includedComponents.forEach(component => {
                const isSelected = component.id === selectedComponentId;
                const rowHtml = `
                    <tr class="${isSelected ? 'selected-row' : ''} hover:bg-gray-50 cursor-pointer" onclick="selectComponent('${component.id}')">
                        <td class="flex items-center gap-2">
                            <span>${component.name}</span>
                        </td>
                        <td>${component.dataset}</td>
                        <td>${component.schemaPath}</td>
                        <td class="text-right">
                            <button class="delete-btn text-gray-500 hover:text-red-600 font-bold text-lg px-2" onclick="deleteComponent('${component.id}', event)">&times;</button>
                        </td>
                    </tr>
                `;

                if (component.type === 'metric') {
                    metricsBody.innerHTML += rowHtml;
                    metricCount++;
                } else {
                    dimensionsBody.innerHTML += rowHtml;
                    dimensionCount++;
                }
            });

            document.getElementById('metrics-count').textContent = metricCount;
            document.getElementById('dimensions-count').textContent = dimensionCount;
        }

        // Select a component to show its settings in the right rail
        window.selectComponent = function(id) {
            selectedComponentId = id;
            const component = includedComponents.find(c => c.id === id);
            
            if (component) {
                document.getElementById('config-rail').style.display = 'block';
                document.getElementById('config-rail-placeholder').style.display = 'none';
                
                document.getElementById('component-name-input').value = component.name;
                document.getElementById('component-dataset-info').textContent = component.dataset;
                document.getElementById('component-schema-info').textContent = component.schemaPath;
            }
            renderIncludedComponents(); // Re-render to show selection highlight
        }
        
        // Hide config rail
        window.deselectComponent = function() {
            selectedComponentId = null;
            document.getElementById('config-rail').style.display = 'none';
            document.getElementById('config-rail-placeholder').style.display = 'block';
            renderIncludedComponents();
        }

        // Delete a component from the list
        window.deleteComponent = function(id, event) {
            event.stopPropagation(); // Prevent row selection
            includedComponents = includedComponents.filter(c => c.id !== id);
            
            if (selectedComponentId === id) {
                deselectComponent();
            } else {
                renderIncludedComponents();
            }
        }

        // Update component name from right rail
        window.updateComponentName = function(newName) {
            if (selectedComponentId) {
                const component = includedComponents.find(c => c.id === selectedComponentId);
                if (component) {
                    component.name = newName;
                    renderIncludedComponents(); // Re-render to update the name in the list
                }
            }
        }

        // --- NEW Workspace Function ---
        
        // Render the components in the Workspace left rail
        window.renderWorkspaceComponents = function() {
            const rail = document.getElementById('workspace-components-rail');
            if (!rail) return;

            const metrics = includedComponents.filter(c => c.type === 'metric');
            const dimensions = includedComponents.filter(c => c.type === 'dimension');

            let html = '<h3 class="text-base font-semibold text-gray-700 mb-2">Dimensions</h3>';
            html += '<div class="flex flex-wrap gap-2">';
            dimensions.forEach(d => {
                html += `<span class="dim-pill rounded-full">${d.name}</span>`;
            });
            if (dimensions.length === 0) html += `<p class="text-sm text-gray-500 italic">No dimensions configured.</p>`;
            html += '</div>';

            html += '<h3 class="text-base font-semibold text-gray-700 mt-4 mb-2">Metrics</h3>';
            html += '<div class="flex flex-wrap gap-2">';
            metrics.forEach(m => {
                html += `<span class="metric-pill rounded-full">${m.name}</span>`;
            });
            if (metrics.length === 0) html += `<p class="text-sm text-gray-500 italic">No metrics configured.</p>`;
            html += '</div>';

            rail.innerHTML = html;
        }

        // Initialize the page *after* the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            showPage('page-connections');
            renderIncludedComponents(); // Initial render for Data View page
        });
    </script>
</head>
<body class="bg-gray-100 h-screen">
    <div class="flex flex-col w-full h-full">
        <!-- App Header and Navigation -->
        <header class="bg-white border-b border-gray-200 px-6">
            <nav class="flex -mb-px">
                <button class="nav-tab active text-gray-600 font-medium py-4 px-6 border-b-2 border-transparent" onclick="showPage('page-connections')">1. Connections</button>
                <button class="nav-tab text-gray-600 font-medium py-4 px-6 border-b-2 border-transparent" onclick="showPage('page-dataview')">2. Data Views</button>
                <button class="nav-tab text-gray-600 font-medium py-4 px-6 border-b-2 border-transparent" onclick="showPage('page-workspace')">3. Workspace</button>
            </nav>
        </header>

        <!-- =================================================================== -->
        <!-- PAGE 1: CJA CONNECTION UI (Key Pair UI)                             -->
        <!-- =================================================================== -->
        <main id="page-connections" class="page flex-col flex-grow p-6 overflow-y-auto overflow-x-hidden bg-gray-50">
            <h1 class="text-2xl font-semibold text-gray-800 mb-6">Untitled connection</h1>
            
            <div class="flex flex-col lg:flex-row gap-6 flex-1 min-w-0">
                <!-- Left Nav Tabs -->
                <div class="lg:w-1/5 flex-shrink-0">
                    <div class="space-y-1">
                        <div class="spectrum-Tabs-item">Event datasets</div>
                        <div class="spectrum-Tabs-item">Profile datasets</div>
                        <div class="spectrum-Tabs-item is-selected">Lookup datasets</div>
                    </div>
                </div>
                
                <!-- Main Configuration Area -->
                <div class="flex-1 bg-white border border-gray-200 rounded-lg shadow-sm p-6 overflow-hidden min-w-0">
                    <h2 class="text-xl font-semibold mb-4">Add datasets</h2>
                    <p class="text-sm text-gray-600 mb-6">Select the lookup datasets to include in this connection. With Shared Lookups, you can add the same dataset multiple times by adding new "key pairs".</p>
                    
                    <div class="border border-gray-200 rounded-md p-5 mb-4">
                        <h3 class="text-lg font-semibold mb-4">Airport Details</h3>
                        
                        <!-- Key Pair #1 -->
                        <div class="border-b border-gray-200 pb-4">
                            <h4 class="text-base font-semibold text-gray-700 mb-3">Key pair #1</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <div>
                                    <label class="spectrum-Label flex items-center gap-1" for="path-1">
                                        Path Name <span class="text-red-600">*</span> <span class="badge-new">NEW</span>
                                        <div class="tooltip-container">
                                            <span class="tooltip-icon">i</span>
                                            <span class="tooltip-text">This name creates a unique path to this lookup (e.g., "Origin Airport"). You will use this in the Data View to choose which join to use.</span>
                                        </div>
                                    </label>
                                    <input type="text" id="path-1" class="spectrum-Textfield" value="Origin Airport">
                                </div>
                                <div>
                                    <label class="spectrum-Label" for="key-1">Key (from Airport Details) <span class="text-red-600">*</span></label>
                                    <select id="key-1" class="spectrum-Picker">
                                        <option>airport_code</option>
                                        <option>city</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="spectrum-Label" for="match-1">Matching key (from Event dataset) <span class="text-red-600">*</span></label>
                                    <select id="match-1" class="spectrum-Picker">
                                        <option>origin_airport_code (from Flight Bookings)</option>
                                        <option>destination_airport_code (from Flight Bookings)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Key Pair #2 (Initially hidden) -->
                        <div id="key-pair-2" class="border-b border-gray-200 py-4" style="display: none;">
                            <h4 class="text-base font-semibold text-gray-700 mb-3">Key pair #2</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <div>
                                    <label class="spectrum-Label flex items-center gap-1" for="path-2">
                                        Path Name <span class="text-red-600">*</span> <span class="badge-new">NEW</span>
                                    </label>
                                    <input type="text" id="path-2" class="spectrum-Textfield" value="Destination Airport">
                                </div>
                                <div>
                                    <label class="spectrum-Label" for="key-2">Key (from Airport Details) <span class="text-red-600">*</span></label>
                                    <select id="key-2" class="spectrum-Picker">
                                        <option>airport_code</option>
                                        <option>city</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="spectrum-Label" for="match-2">Matching key (from Event dataset) <span class="text-red-600">*</span></label>
                                    <select id="match-2" class="spectrum-Picker">
                                        <option>destination_airport_code (from Flight Bookings)</option>
                                        <option>origin_airport_code (from Flight Bookings)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add Pair Button -->
                        <div id="add-pair-button-container" class="pt-4">
                            <button class="btn-secondary text-sm font-semibold py-1.5 px-3 rounded" onclick="addNewPair()">
                                + Add new pair
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer/Actions -->
            <footer class="mt-auto pt-6 text-right">
                <button class="btn-primary text-white font-semibold py-2 px-4 rounded-md shadow-sm" onclick="showPage('page-dataview')">
                    Save and Continue to Data View
                </button>
            </footer>
        </main>

        <!-- =================================================================== -->
        <!-- PAGE 2: CJA DATA VIEW UI (Interactive)                              -->
        <!-- =================================================================== -->
        <main id="page-dataview" class="page" style="display: none; padding: 0; height: 100%;">
            <div class="w-full h-full flex flex-col">
                <div class="p-4 border-b border-gray-200 bg-white flex-shrink-0">
                    <h1 class="text-xl font-semibold text-gray-800">Data View: Airline Analytics DV</h1>
                </div>
                <!-- NEW 3-COLUMN LAYOUT -->
                <div class="grid grid-cols-12 flex-grow h-0">
                    <!-- Left Rail: Schema (Interactive) -->
                    <div class="col-span-3 dv-left-rail flex-shrink-0 h-full overflow-y-auto">
                        <div class="p-4">
                            <input type="text" placeholder="Search schema fields" class="spectrum-Textfield">
                        </div>
                        <div class="dv-component-group">Lookup datasets</div>
                        
                        <div class="dv-dataset-item" id="airport-details-toggle" onclick="toggleAirportDetails()">
                            <code>Airport Details</code>
                        </div>
                        <div class="lookup-flyout" id="airport-details-flyout" style="display: none;">
                            <h4>Choose a join path:</h4>
                            <label>
                                <input type="radio" name="join-path" value="Origin Airport" checked> <strong>via "Origin Airport"</strong>
                            </label>
                            <label>
                                <input type="radio" name="join-path" value="Destination Airport"> <strong>via "Destination Airport"</strong>
                            </label>
                            <hr class="my-3 border-gray-300">
                            <h4>Fields:</h4>
                            <div class="pl-2">
                                <div class="dv-component-item !pl-2 !pb-1" onclick="addComponent('airport_name')"><code>airport_name</code></div>
                                <div class="dv-component-item !pl-2 !pb-1" onclick="addComponent('city')"><code>city</code></div>
                                <div class="dv-component-item !pl-2 !pb-1 metric" onclick="addComponent('monthly_campaign_spend')"><code>monthly_campaign_spend</code></div>
                            </div>
                        </div>
                        
                        <div class="dv-component-group">Event datasets</div>
                        <div class="dv-dataset-item"><code>Flight Bookings</code></div>
                        <div class="dv-component-item !pl-10 metric" onclick="addComponent('bookings')"><code>Bookings</code></div>

                        <div class="dv-component-group">Adobe lookups</div>
                    </div>

                    <!-- Center Rail: Included Components -->
                    <div class="col-span-5 h-full overflow-y-auto bg-white">
                        <div class="p-4">
                            <h2 class="text-lg font-semibold mb-4">Included components (<span id="component-count">1</span>)</h2>
                            <input type="text" placeholder="Search components" class="spectrum-Textfield mb-4">
                            <table class="w-full dv-main-table">
                                <thead>
                                    <tr><th colspan="4">METRICS (<span id="metrics-count">1</span>)</th></tr>
                                    <tr>
                                        <th>COMPONENT NAME</th>
                                        <th>DATASET</th>
                                        <th>SCHEMA PATH</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="metrics-tbody">
                                    <!-- Components will be rendered here by renderIncludedComponents() -->
                                </tbody>
                            </table>
                            <table class="w-full dv-main-table mt-6">
                                <thead>
                                    <tr><th colspan="4">DIMENSIONS (<span id="dimensions-count">0</span>)</th></tr>
                                    <tr>
                                        <th>COMPONENT NAME</th>
                                        <th>DATASET</th>
                                        <th>SCHEMA PATH</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="dimensions-tbody">
                                    <!-- Components will be rendered here by renderIncludedComponents() -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Right Rail: Component Settings -->
                    <div class="col-span-4 h-full overflow-y-auto bg-gray-50 border-l border-gray-200">
                        <!-- Placeholder -->
                        <div id="config-rail-placeholder" class="p-6 text-center text-gray-500">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            <h3 class="mt-2 text-sm font-medium text-gray-900">Select a component</h3>
                            <p class="mt-1 text-sm text-gray-500">Select a component from the center panel to edit its settings.</p>
                        </div>
                        
                        <!-- Real Settings Panel -->
                        <div id="config-rail" style="display: none;">
                            <div class="p-4 border-b border-gray-200">
                                <h3 class="text-lg font-semibold">Component settings</h3>
                            </div>
                            <div class="p-4 space-y-4">
                                <div>
                                    <label class="spectrum-Label" for="component-name-input">Component Name</label>
                                    <input type="text" id="component-name-input" class="spectrum-Textfield" oninput="updateComponentName(this.value)">
                                </div>
                                <div>
                                    <h4 class="spectrum-Label">Dataset</h4>
                                    <p id="component-dataset-info" class="text-sm text-gray-700"></p>
                                </div>
                                <div>
                                    <h4 class="spectrum-Label">Schema Path</h4>
                                    <p id="component-schema-info" class="text-sm text-gray-600 font-mono text-xs"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <footer class="mt-auto p-4 text-right bg-white border-t border-gray-200 flex-shrink-0">
                    <button class="btn-primary text-white font-semibold py-2 px-4 rounded-md shadow-sm" onclick="showPage('page-workspace')">
                        Save and go to Workspace
                    </button>
                </footer>
            </div>
        </main>

        <!-- =================================================================== -->
        <!-- PAGE 3: ANALYSIS WORKSPACE                                          -->
        <!-- =================================================================== -->
        <main id="page-workspace" class="page" style="display: none; padding: 0; height: 100%;">
            <div class="w-full h-full flex flex-col">
                <h1 class="text-2xl font-semibold text-gray-800 p-6 pb-0 flex-shrink-0">Workspace: Airline Route Performance</h1>
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 flex-grow h-0 p-6 pt-6"> <!-- h-0 trick -->
                    <!-- Left Rail: Components (NOW DYNAMIC) -->
                    <div class="lg:col-span-1 bg-white border border-gray-200 rounded-lg shadow-sm flex flex-col h-full max-h-full">
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold">Components</h2>
                        </div>
                        <!-- This div will be populated by renderWorkspaceComponents() -->
                        <div id="workspace-components-rail" class="p-4 overflow-y-auto">
                            <!-- Example:
                            <h3 class="text-base font-semibold text-gray-700 mb-2">Dimensions</h3>
                            <div class="flex flex-wrap gap-2">
                                <span class="dim-pill rounded-full">Origin Airport</span>
                            </div>
                            -->
                        </div>
                    </div>
                    
                    <!-- Main Panel: Report (RESTORED) -->
                    <div class="lg:col-span-3 bg-white border border-gray-200 rounded-lg shadow-sm flex flex-col h-full max-h-full">
                        <div class="p-6 overflow-y-auto">
                            <h3 class="text-xl font-semibold mb-2">Freeform Table: Route Spend Analysis</h3>
                            <p class="text-sm text-gray-600 mb-4"><strong>Business Question:</strong> "For our top-performing routes, what is our marketing spend at the origin airport vs. the destination airport?"</p>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full min-w-max border-collapse text-sm ws-table">
                                    <thead>
                                        <tr>
                                            <th class="border border-gray-200 p-3 text-left">Origin Airport</th>
                                            <th class="border border-gray-200 p-3 text-left">Destination Airport</th>
                                            <th class="border border-gray-200 p-3 text-right">Bookings</th>
                                            <th class="border border-gray-200 p-3 text-right">Origin Campaign Spend</th>
                                            <th class="border border-gray-200 p-3 text-right">Destination Campaign Spend</th>
                                        </tr>
                                    </thead>
                                    <!-- RESTORED EXAMPLE DATA -->
                                    <tbody class="divide-y divide-gray-100">
                                        <tr>
                                            <td class="border-b border-gray-200 p-3">Los Angeles (LAX)</td>
                                            <td class="border-b border-gray-200 p-3">New York (JFK)</td>
                                            <td class="border-b border-gray-200 p-3 text-right">12,500</td>
                                            <td class="border-b border-gray-200 p-3 text-right">$50,000</td>
                                            <td class="border-b border-gray-200 p-3 text-right">$75,000</td>
                                        </tr>
                                        <tr>
                                            <td class="border-b border-gray-200 p-3">Los Angeles (LAX)</td>
                                            <td class="border-b border-gray-200 p-3">Chicago (ORD)</td>
                                            <td class="border-b border-gray-200 p-3 text-right">9,800</td>
                                            <td class="border-b border-gray-200 p-3 text-right">$50,000</td>
                                            <td class="border-b border-gray-200 p-3 text-right">$40,000</td>
                                        </tr>
                                        <tr>
                                            <td class="border-b border-gray-200 p-3">San Francisco (SFO)</td>
                                            <td class="border-b border-gray-200 p-3">New York (JFK)</td>
                                            <td class="border-b border-gray-200 p-3 text-right">11,200</td>
                                            <td class="border-b border-gray-200 p-3 text-right">$60,000</td>
                                            <td class="border-b border-gray-200 p-3 text-right">$75,000</td>
                                        </tr>
                                        <tr>
                                            <td class="border-b border-gray-200 p-3">...</td>
                                            <td class="border-b border-gray-200 p-3">...</td>
                                            <td class="border-b border-gray-200 p-3 text-right">...</td>
                                            <td class="border-b border-gray-200 p-3 text-right">...</td>
                                            <td class="border-b border-gray-200 p-3 text-right">...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
